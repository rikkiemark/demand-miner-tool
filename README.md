# Demand Miner Tool - SEO キーワード需要掘削ツール

## 概要

Demand Miner Tool は、**SEO（検索エンジン最適化）において「競合が少なく、かつ検索需要があるキーワード」を自動的に発見するツール**です。

ブログやWebメディアの運営者が記事を書く際、「どのキーワードを狙えば検索上位を取れるか？」を判断するのは時間がかかる作業です。本ツールはその作業を自動化し、数千のキーワード候補の中から「今すぐ記事にすべきお宝キーワード」をランク付きで提示します。

### 解決する課題

| 従来の手動リサーチ | Demand Miner Tool |
|---|---|
| 1キーワードずつ Google で検索して競合を確認 | 数千キーワードを自動で一括分析 |
| 勘と経験に頼ったキーワード選定 | データに基づいた SS〜C の5段階ランク判定 |
| 同じキーワードを何度も調べ直す | Smart TTL キャッシュで無駄な API コールを削減 |
| ジャンルが変わるたびにゼロから設定 | プロファイルシステムでジャンル別にワード群を管理 |

---

## 主な機能

### 1. スマート再帰掘り（Route A）

Google の検索サジェスト（検索窓に文字を入力すると表示される候補）を**再帰的に深掘り**していく機能です。

**従来の総当たり方式**では、10個の種キーワード × 10個のフィルターワード × 全サジェスト = 約5,400回の API 呼び出しが必要でした。スマート再帰掘りでは、**フィルターキーワードが含まれる有望な枝だけを選択的に深掘り**することで、API コール数を約700〜1,000回に削減しています。

#### 動作の流れ

```
Step 1: 種キーワード「ダイエット」で Google サジェストを取得
        → [ダイエット 食事, ダイエット 運動, ダイエット 続かない, ダイエット リバウンド, ...]

Step 2: フィルターキーワード（続かない, リバウンド, 失敗 等）でフィルタリング
        → 「ダイエット 続かない」「ダイエット リバウンド」はフィルターワードを含む → 深掘り対象
        → 「ダイエット 食事」「ダイエット 運動」は含まない → スキップ（API 節約）

Step 3: 深掘り対象を次の階層で再度サジェスト取得
        → 「ダイエット 続かない」→ [ダイエット 続かない 理由, ダイエット 続かない 対策, ...]

Step 4: 最大3階層まで繰り返し
```

#### なぜ効率的なのか

```
従来（総当たり）:
  10種 × 10フィルター × 各サジェスト取得 = 約5,400 API コール

スマート再帰掘り:
  10種 → サジェスト取得（10回）
    → フィルター通過分のみ深掘り（約70回）
      → さらに深掘り（約200回）
  合計: 約700〜1,000 API コール（約80%削減）
```

### 2. 総当たり組み合わせ（Route B）

Google トレンドで取得した**急上昇ワード**と、あらかじめ設定したワード群の**全組み合わせ**を生成し、それぞれのサジェストを取得します。

```
例: トレンド「新型iPhone」× 補助ワード「比較」× フィルターワード「後悔」
  → 「新型iPhone 比較 後悔」で Google サジェストを取得
```

トレンドに乗った一時的な需要を、ユーザーの悩み・関心の切り口で記事化する戦略に向いています。

### 3. ランク自動判定（SS〜C）

発見したキーワードを、**競合の少なさ**と**情報の新しさ**の2軸で自動ランク付けします。

| ランク | 判定条件 | 推奨アクション |
|--------|----------|---------------|
| **SS**（スナイパー） | allintitle 1〜5件 + 検索結果が全て監視対象サイト + 24時間以内に投稿あり | 最優先で記事作成（競合がほぼ身内のみ） |
| **S**（お宝） | allintitle 0件、または 90日以上新規記事なし | 優先的に記事作成（競合ゼロ or 放置状態） |
| **A**（有望） | 30日以上新規記事なし | 記事作成候補（更新が止まっている） |
| **B**（様子見） | 7日以上新規記事なし | 一旦保留（少し競合が動いている） |
| **C**（撤退） | 7日以内に新規記事あり（競合が活発） | 撤退推奨（レッドオーシャン） |

#### 判定に使用するデータ

- **allintitle 検索**: Google Custom Search API で `allintitle:キーワード` を検索し、タイトルにそのキーワードを含む記事の件数を取得。件数が少ないほど競合が少ない
- **時間指定検索**: 過去7日/30日/90日以内に公開された記事の件数を取得。件数が少ないほど情報が古く、上位を奪いやすい
- **ドメインマッチ**: 検索結果のドメインが、事前に登録した監視対象サイト（自サイトや特定の競合サイト）と一致するかを確認。全一致ならスナイパー判定（SS ランク）の条件の1つ

### 4. Smart TTL キャッシュ

API コール数を節約するための仕組みです。一度分析したキーワードの結果をローカルに保存し、**ランクに応じて再チェックの頻度を自動調整**します。

| ランク | キャッシュ有効期限 | 理由 |
|--------|-------------------|------|
| SS / S | 0時間（毎回再チェック） | お宝キーワードは状況変化を見逃さない |
| A | 24時間 | 1日1回の確認で十分 |
| B | 48時間 | 変動が少ないため2日間キャッシュ |
| C | 168時間（1週間） | レッドオーシャンは頻繁な再チェック不要 |

さらに、大量キーワードの分析中に100件ごとに自動中間保存（チェックポイント機能）を行うため、処理が中断しても途中から再開できます。

### 5. プロファイルシステム

ジャンルごとに**ワード群と分析設定を分離管理**する仕組みです。

```
profiles/
├── health/            # 健康ジャンル（例）
│   ├── settings.yaml  # ジャンル固有の設定
│   └── data/
│       ├── seeds.txt      # 種キーワード: ダイエット, 筋トレ, 睡眠, ...
│       ├── filters.txt    # フィルターワード: 続かない, 失敗, 効果ない, ...
│       ├── connectors.txt # 補助ワード: 初心者, 40代, 自宅, ...
│       └── sites.txt      # 監視対象ドメイン
├── gadget/            # ガジェットジャンル（例）
│   ├── settings.yaml
│   └── data/
│       ├── seeds.txt      # スマートフォン, イヤホン, タブレット, ...
│       ├── filters.txt    # 後悔, 不具合, 比較, ...
│       └── ...
└── _template/         # 新規ジャンル作成用テンプレート
```

テンプレートをコピーして新しいジャンルのプロファイルを追加できます。ワードファイルは1行1ワードのテキストファイルで、プログラミング知識なしに編集可能です。

### 6. GUI（Gradio）

ブラウザ上で操作できる Web ベースの GUI を搭載しています。

#### 画面構成

```
┌──────────────────────────────────────────────────────┐
│  Demand Miner Tool                                    │
├─────────────────┬────────────────────────────────────┤
│                 │                                      │
│  プロファイル選択  │  結果サマリー                         │
│  [health ▼]     │  ┌──────────────────────────────┐   │
│                 │  │ 分析完了: 1409件のキーワード      │   │
│  実行モード      │  │                                │   │
│  ● プリセット    │  │ ランク別集計:                     │   │
│  ○ カスタム     │  │   SS: 3件                       │   │
│                 │  │   S: 45件                       │   │
│  パターン選択    │  │   A: 120件                      │   │
│  [定番ルート ▼]  │  │   B: 340件                      │   │
│                 │  │   C: 901件                      │   │
│  □ キャッシュ無視 │  └──────────────────────────────┘   │
│                 │                                      │
│  [分析開始]     │  結果CSV ダウンロード                   │
│                 │  [result_20250217_1836.csv]           │
│                 │                                      │
│                 │  実行ログ                              │
│                 │  ┌──────────────────────────────┐   │
│                 │  │ [18:35:01] プロファイル読み込み中  │   │
│                 │  │ [18:35:02] サジェスト取得中...     │   │
│                 │  │ [18:36:01] サジェスト合計: 1409件  │   │
│                 │  └──────────────────────────────┘   │
└─────────────────┴────────────────────────────────────┘
```

#### 操作モード

- **プリセットモード（推奨）**: あらかじめ設定された分析パターンをワンクリックで実行
- **カスタムモード**: マイニングモードやワード群を自由に組み合わせて分析

---

## 動作環境

| 項目 | 要件 |
|------|------|
| OS | macOS / Windows / Linux |
| Python | 3.9 以上 |
| 動作環境 | ローカル PC または Google Colab |
| 必須 API | なし（サジェスト取得のみなら API キー不要） |
| 任意 API | Google Custom Search JSON API（ランク判定に必要） |

> **Note:** Google Custom Search JSON API は現在、新規ユーザーの受付を停止しています（2025年時点）。申請フォームからリクエスト可能です。API キーがない場合でも、サジェスト取得機能（Route A / Route B）は動作します。

---

## 技術スタック

| コンポーネント | 技術 | 用途 |
|--------------|------|------|
| 言語 | Python 3.9+ | アプリケーション全体 |
| GUI | Gradio 4.36 | ブラウザベースの操作画面 |
| サジェスト取得 | Google Suggest API（非公式） | キーワード候補の自動収集 |
| トレンド取得 | pytrends | Google トレンド急上昇ワードの取得 |
| 競合分析 | Google Custom Search JSON API | allintitle 検索・時間指定検索 |
| 設定管理 | YAML | グローバル設定・プロファイル設定 |
| キャッシュ | JSON（ファイルベース） | 分析結果のローカル保存 |

---

## システム構成

```
demand_miner_tool/
│
├── main.py                     # エントリーポイント（GUI 起動）
├── requirements.txt            # Python 依存パッケージ
│
├── config/
│   ├── settings.yaml           # グローバル設定
│   ├── api_keys.yaml           # API キー（Git 管理対象外）
│   └── api_keys.yaml.example   # API キー設定のテンプレート
│
├── core/                       # コアロジック
│   ├── profile_manager.py      # プロファイル読み込み・バリデーション
│   ├── suggest_fetcher.py      # サジェスト取得エンジン
│   │                             - smart_recursive_search(): スマート再帰掘り
│   │                             - brute_force_combinations(): 総当たり組み合わせ
│   ├── trend_fetcher.py        # Google トレンド急上昇ワード取得
│   ├── search_analyzer.py      # Google Custom Search API 連携
│   │                             - get_allintitle_count(): 競合件数取得
│   │                             - get_recent_results(): 時間指定検索
│   │                             - check_domain_match(): ドメイン判定
│   ├── ranker.py               # ランク判定エンジン（SS/S/A/B/C）
│   └── cache_manager.py        # キャッシュ管理（Smart TTL）
│
├── gui/
│   └── gradio_app.py           # Gradio GUI
│
├── profiles/                   # ジャンル別プロファイル
│   └── _template/              # 新規作成用テンプレート
│
├── cache/                      # キャッシュ保存先（Git 管理対象外）
├── outputs/                    # 結果 CSV 出力先（Git 管理対象外）
└── colab_setup.ipynb           # Google Colab セットアップ用ノートブック
```

---

## 処理フロー

```
[ユーザー操作]
    │
    ▼
┌─────────────────┐
│ プロファイル選択   │  health / gadget / ...
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ パターン選択      │  Route A / Route B / 両方
└────────┬────────┘
         │
         ▼
┌─────────────────────────────────────────┐
│ Step 1: サジェスト取得                      │
│                                           │
│  Route A: スマート再帰掘り                   │
│    種キーワード → サジェスト取得              │
│    → フィルター → 有望な枝だけ深掘り          │
│    → 最大3階層まで再帰                      │
│                                           │
│  Route B: 総当たり                          │
│    Google トレンド取得                       │
│    → トレンド × ワード群の全組み合わせ生成    │
│    → 各組み合わせでサジェスト取得             │
└────────────────────┬────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────┐
│ Step 2: 重複排除                           │
│  全サジェストから重複を除去                   │
└────────────────────┬────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────┐
│ Step 3: キャッシュ確認                      │
│  各キーワードについて:                       │
│  ├─ キャッシュあり（TTL内）→ キャッシュ利用   │
│  └─ キャッシュなし or 期限切れ → API 実行     │
└────────────────────┬────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────┐
│ Step 4: 競合分析（API 実行）                │
│  1. allintitle 検索 → 競合件数を取得        │
│  2. 時間指定検索（7日/30日/90日）            │
│     → 各期間の記事件数を取得                 │
│  3. ドメインマッチ確認（スナイパー判定用）     │
└────────────────────┬────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────┐
│ Step 5: ランク判定                          │
│  SS / S / A / B / C を自動判定               │
│  → キャッシュに結果を保存（Smart TTL 付き）    │
└────────────────────┬────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────┐
│ Step 6: 結果出力                           │
│  - GUI にランク別集計を表示                  │
│  - CSV ファイルに全結果をエクスポート          │
│    (rank, keyword, allintitle_count, route)  │
└─────────────────────────────────────────┘
```

---

## 設定項目

### グローバル設定（config/settings.yaml）

| カテゴリ | 設定項目 | デフォルト値 | 説明 |
|---------|---------|------------|------|
| レート制限 | `wait_seconds` | 1.0 | API リクエスト間の待機時間（秒） |
| マイニング | `max_recursion_depth` | 3 | スマート再帰掘りの最大階層数 |
| キャッシュ | `ttl_hours` | 24 | デフォルトのキャッシュ有効期限（時間） |
| キャッシュ | `smart_ttl.enabled` | true | ランク別 TTL の有効/無効 |
| バッチ | `checkpoint_interval` | 100 | 中間保存を行う間隔（件数） |
| タイムアウト | `suggest_api` | 10 | サジェスト API のタイムアウト（秒） |
| タイムアウト | `custom_search_api` | 15 | Custom Search API のタイムアウト（秒） |
| タイムアウト | `trends_api` | 20 | トレンド API のタイムアウト（秒） |

### プロファイル設定（profiles/\*/settings.yaml）

| カテゴリ | 設定項目 | 説明 |
|---------|---------|------|
| 基本 | `name` | プロファイルの表示名 |
| ワード群 | `word_groups` | ワード群の定義（ID、名前、ファイルパス） |
| パターン | `preset_patterns` | プリセット分析パターンの定義 |
| ランク閾値 | `ranking.rank_s_days` | S ランク判定の日数閾値（デフォルト: 90日） |
| ランク閾値 | `ranking.rank_a_days` | A ランク判定の日数閾値（デフォルト: 30日） |
| ランク閾値 | `ranking.rank_b_days` | B ランク判定の日数閾値（デフォルト: 7日） |
| スナイパー | `sniper.max_competitors` | SS 判定の最大競合数（デフォルト: 5） |
| スナイパー | `sniper.hours_threshold` | SS 判定の時間閾値（デフォルト: 24時間） |
| フィルタ | `filtering.max_allintitle_results` | 即 C 判定する競合数の上限（デフォルト: 10） |

---

## CLI オプション

```bash
python3 main.py [OPTIONS]
```

| オプション | 説明 |
|-----------|------|
| `--no-cache` | キャッシュを無視して全キーワードを再取得 |
| `--share` | Gradio 公開リンクを生成（Google Colab 用） |
| `--port N` | サーバーのポート番号を指定（デフォルト: 7860） |

---

## 出力形式

### CSV ファイル

分析結果は `outputs/<profile_name>/results/result_YYYYMMDD_HHMMSS.csv` に保存されます。

| カラム | 型 | 説明 |
|--------|---|------|
| `rank` | 文字列 | SS / S / A / B / C / ?（API 未設定時） |
| `keyword` | 文字列 | 分析対象キーワード |
| `allintitle_count` | 整数 | allintitle 検索結果件数（-1: 取得失敗） |
| `route` | 文字列 | 使用した分析パターン名 |

```csv
rank,keyword,allintitle_count,route
SS,ダイエット 続かない 対策 40代,2,定番ルート（スマート再帰掘り）
S,筋トレ 効果ない 初心者,0,定番ルート（スマート再帰掘り）
A,睡眠 改善 サプリ,3,定番ルート（スマート再帰掘り）
B,新型iPhone 比較 後悔,8,トレンドルート（総当たり）
C,ダイエット 食事 メニュー,156,定番ルート（スマート再帰掘り）
```

---

## ステータス

| 項目 | 状態 |
|------|------|
| サジェスト取得（Route A / B） | 稼働中 |
| トレンドワード取得 | 稼働中 |
| GUI（Gradio） | 稼働中 |
| キャッシュ機能 | 稼働中 |
| ランク判定（Custom Search API） | API 申請中 |

---

## ライセンス

MIT License
